load("@io_bazel_rules_kotlin//kotlin:kotlin.bzl", "kt_jvm_library")
load(":macros.bzl", "generate_root_certificate", "generate_server_certificate")

package(
    default_testonly = True,
    default_visibility = [
        "//src/main/kotlin/org/wfanet/measurement/consent:__subpackages__",
        "//src/test/kotlin/org/wfanet/measurement/consent:__subpackages__",
    ],
)

generate_root_certificate(
    name = "edp_1_root",
    srcs = ["openssl.cnf"],
)

generate_server_certificate(
    name = "edp_1_server",
    srcs = [
        "openssl.cnf",
        ":edp_1_root",
    ],
    root = "edp_1_root",
)

generate_root_certificate(
    name = "aggregator_root",
    srcs = ["openssl.cnf"],
)

generate_server_certificate(
    name = "aggregator_server",
    srcs = [
        "openssl.cnf",
        ":aggregator_root",
    ],
    root = "aggregator_root",
)

generate_root_certificate(
    name = "non_aggregator_1_root",
    srcs = ["openssl.cnf"],
)

generate_server_certificate(
    name = "non_aggregator_1_server",
    srcs = [
        "openssl.cnf",
        ":non_aggregator_1_root",
    ],
    root = "non_aggregator_1_root",
)

kt_jvm_library(
    name = "testing",
    srcs = glob(["*.kt"]),
    data = [
        "aggregator_server.key",
        "aggregator_server.pem",
        "edp_1_server.key",
        "edp_1_server.pem",
        "non_aggregator_1_server.key",
        "non_aggregator_1_server.pem",
        "@wfa_common_jvm//src/main/kotlin/org/wfanet/measurement/common/crypto/testing/testdata:certs",
    ],
    deps = [
        "@wfa_common_jvm//src/main/kotlin/org/wfanet/measurement/common",
    ],
)
